<Window x:Class="openHAB.Windows.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:converters="using:openHAB.Windows.Converters"
        xmlns:core="using:Microsoft.Xaml.Interactions.Core"
        xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
        xmlns:interactivity="using:Microsoft.Xaml.Interactivity"
        xmlns:model="using:openHAB.Core.Client.Models"
        xmlns:behaviors="using:CommunityToolkit.WinUI.Behaviors"
        mc:Ignorable="d"
        Title="openHab"
        x:Name="Window">
    <Window.SystemBackdrop>
        <DesktopAcrylicBackdrop />
    </Window.SystemBackdrop>
    <Grid Name="Root">
        <Grid.Resources>
            <Style TargetType="GridViewItem">
                <Setter Property="HorizontalContentAlignment"
                        Value="Stretch" />
                <Setter Property="VerticalContentAlignment"
                        Value="Stretch" />
            </Style>
            <Style TargetType="muxc:NavigationViewItem">
                <Setter Property="FontSize"
                        Value="18" />
            </Style>
            <Style x:Key="SitemapHeader"
                   TargetType="TextBlock">
                <Setter Property="FontSize"
                        Value="42" />
            </Style>
            <Style x:Key="BreakcrumbItemText"
                   TargetType="TextBlock">
                <Setter Property="FontSize"
                        Value="21" />
            </Style>
            <!-- Navigation View Styling -->
            <SolidColorBrush x:Key="NavigationViewItemForegroundPointerOver"
                             Color="#FFFF5722" />
            <SolidColorBrush x:Key="NavigationViewItemForegroundChecked"
                             Color="#FFFF5722" />
            <SolidColorBrush x:Key="NavigationViewItemForegroundCheckedPressed"
                             Color="#FFFF5722" />
            <SolidColorBrush x:Key="NavigationViewItemForegroundSelected"
                             Color="#FFFF5722" />
            <SolidColorBrush x:Key="NavigationViewItemForegroundSelectedPressed"
                             Color="#FFFF5722" />
            <SolidColorBrush x:Key="NavigationViewSelectionIndicatorForeground"
                             Color="#FFFF5722" />
            <!-- Converters -->
            <converters:NullToVisibilityConverter x:Key="NullToVisibility" />
            <converters:NullToBooleanConverter x:Key="NullToBooleanConverter" />
            <converters:ObjectToSitemapConverter x:Key="ObjectToSitemapConverter" />
            <converters:ZeroToVisibilityConverter x:Key="ZeroToVisibility" />
            <converters:BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
            <converters:MenuItemTemplateSelector x:Key="Selector">
                <converters:MenuItemTemplateSelector.DefaultItemTemlate>
                    <DataTemplate x:DataType="muxc:NavigationViewItem">
                        <muxc:NavigationViewItem Margin="-15,0,0,0"
                                                 Content="{Binding}" />
                    </DataTemplate>
                </converters:MenuItemTemplateSelector.DefaultItemTemlate>
                <converters:MenuItemTemplateSelector.SiteMapMenuItemTemplate>
                    <DataTemplate x:DataType="model:Sitemap">
                        <muxc:NavigationViewItem Content="{Binding Label, Mode=OneWay}">
                            <muxc:NavigationViewItem.Icon>
                                <muxc:ImageIcon Source="ms-appx:///Assets/openhab.png"
                                                Width="48"
                                                Height="48" />
                            </muxc:NavigationViewItem.Icon>
                            <interactivity:Interaction.Behaviors>
                                <core:EventTriggerBehavior EventName="Tapped">
                                    <core:NavigateToPageAction TargetPage="openHAB.Windows.View.SettingsPage" />
                                </core:EventTriggerBehavior>
                            </interactivity:Interaction.Behaviors>
                        </muxc:NavigationViewItem>
                    </DataTemplate>
                </converters:MenuItemTemplateSelector.SiteMapMenuItemTemplate>
            </converters:MenuItemTemplateSelector>
        </Grid.Resources>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <Grid x:Name="AppTitleBar"
              Grid.Row="0"
              Height="48">
            <Grid.ColumnDefinitions>
                <ColumnDefinition x:Name="LeftPaddingColumn"
                                  Width="0" />
                <ColumnDefinition x:Name="IconColumn"
                                  Width="Auto" />
                <ColumnDefinition x:Name="TitleColumn"
                                  Width="Auto" />
                <ColumnDefinition x:Name="LeftDragColumn"
                                  Width="*" />
                <ColumnDefinition x:Name="SearchColumn"
                                  Width="4*"
                                  MinWidth="220" />
                <ColumnDefinition x:Name="RightDragColumn"
                                  Width="*"
                                  MinWidth="48" />
                <ColumnDefinition x:Name="AccountColumn"
                                  Width="Auto" />
                <ColumnDefinition x:Name="RightPaddingColumn"
                                  Width="0" />
            </Grid.ColumnDefinitions>
            <Image x:Name="TitleBarIcon"
                   Source="ms-appx:///Assets/openhab.png"
                   Grid.Column="1"
                   Width="16"
                   Height="16"
                   Margin="8,0,4,0" />
            <TextBlock x:Name="TitleBarTextBlock"
                       Text="App title"
                       Style="{StaticResource CaptionTextBlockStyle}"
                       Grid.Column="2"
                       VerticalAlignment="Center" />
            <!--<AutoSuggestBox x:Name="TitleBarSearchBox"
                            Grid.Column="4"
                            QueryIcon="Find"
                            PlaceholderText="Search"
                            VerticalAlignment="Center"
                            MaxWidth="600" />-->
        </Grid>
        <muxc:NavigationView x:Name="SitemapNavigation"
                             Grid.Row="1"
                             Grid.RowSpan="2"
                             MenuItemsSource="{x:Bind Vm.Sitemaps, Mode=OneWay}"
                             MenuItemTemplateSelector="{StaticResource Selector}"
                             SelectedItem="{x:Bind Vm.SelectedMenuItem, Mode=TwoWay}"
                             IsBackButtonVisible="Collapsed"
                             AlwaysShowHeader="False"
                             IsSettingsVisible="True"
                             OpenPaneLength="250"
                             CompactPaneLength="55"
                             PaneDisplayMode="Left"
                             IsPaneOpen="True"
                             SelectionChanged="SitemapNavigation_SelectionChanged">
            <muxc:NavigationView.Header>
                <Grid Visibility="{Binding SelectedSitemap, Converter={StaticResource NullToVisibility}}">
                    <Grid.RowDefinitions>
                        <RowDefinition />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <StackPanel Grid.Row="0"
                                Orientation="Horizontal">
                        <TextBlock Style="{StaticResource SitemapHeader}"
                                   VerticalAlignment="Center"
                                   Text="{Binding Path=SelectedSitemap.Label, Mode=OneWay}"
                                   Tapped="SitemapTextBlock_Tapped" />
                        <Button Margin="10,10,0,0"
                                MaxHeight="35"
                                MaxWidth="35"
                                VerticalAlignment="Center">
                            <FontIcon Glyph="&#xE72C;"
                                      FontSize="12" />
                        </Button>
                    </StackPanel>
                    <BreadcrumbBar Grid.Row="1"
                                   Margin="0,0,0,10"
                                   ItemsSource="{Binding BreadcrumbItems, Mode=TwoWay}"
                                   ItemClicked="BreadcrumbBar_ItemClicked">
                        <BreadcrumbBar.ItemTemplate>
                            <DataTemplate x:DataType="model:Widget">
                                <BreadcrumbBarItem Content="{Binding }">
                                    <BreadcrumbBarItem.ContentTemplate>
                                        <DataTemplate>
                                            <TextBlock Style="{StaticResource BreakcrumbItemText}"
                                                       Text="{Binding Label}" />
                                        </DataTemplate>
                                    </BreadcrumbBarItem.ContentTemplate>
                                </BreadcrumbBarItem>
                            </DataTemplate>
                        </BreadcrumbBar.ItemTemplate>
                    </BreadcrumbBar>
                </Grid>
            </muxc:NavigationView.Header>
            <muxc:NavigationView.PaneCustomContent>
                <StackPanel Orientation="Vertical"
                            Visibility="{Binding IsPaneOpen, ElementName=SitemapNavigation}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="70*" />
                            <ColumnDefinition Width="30*" />
                        </Grid.ColumnDefinitions>
                        <TextBlock x:Name="textBlock"
                                   Grid.Column="0"
                                   Margin="10,-3,0,0"
                                   VerticalAlignment="Center"
                                   Style="{StaticResource MenuSubHeader}"
                                   Text="Sitemaps" />
                        <Button Grid.Column="1"
                                Margin="0,0,10,0"
                                HorizontalAlignment="Right"
                                Command="{Binding Vm.RefreshCommand, ElementName=Window}">
                            <FontIcon Glyph="&#xE72C;"
                                      FontSize="12" />
                        </Button>
                    </Grid>
                    <TextBlock Margin="10,10,10,0"
                               x:Uid="NoItemsOrOpenHabNotAvailable"
                               Visibility="{Binding DataContext.Sitemaps.Count, Converter={StaticResource ZeroToVisibility}, Mode=OneWay, ElementName=ContentFrame}"
                               TextWrapping="Wrap"
                               Style="{StaticResource FlyoutPickerTitleTextBlockStyle}" />
                </StackPanel>
            </muxc:NavigationView.PaneCustomContent>
            <muxc:NavigationView.FooterMenuItems>
                <muxc:NavigationViewItem Icon="Home"
                                         x:Uid="MenuItemMainUI"
                                         Tag="openHAB.Windows.View.MainUIPage"
                                         Tapped="NavigationViewItemMainUI_Tapped" />
            </muxc:NavigationView.FooterMenuItems>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>
                <muxc:InfoBar x:Name="Notification"
                              Grid.Row="0"
                              Margin="15"
                              IsIconVisible="True"
                              IsClosable="True"
                              HorizontalAlignment="Center"
                              VerticalAlignment="Center">
                    <interactivity:Interaction.Behaviors>
                        <behaviors:StackedNotificationsBehavior x:Name="NotificationQueue" />
                    </interactivity:Interaction.Behaviors>
                </muxc:InfoBar>
                <Frame Grid.Row="1" x:Name="ContentFrame" Navigated="ContentFrame_Navigated" />
            </Grid>
        </muxc:NavigationView>
        <Border x:Name="LoadingControl"
                MaxHeight="150"
                MaxWidth="150"
                Grid.Row="1"
                Padding="25"
                BorderThickness="2"
                CornerRadius="10"
                BorderBrush="{StaticResource SolidBackgroundFillColorBaseBrush}"
                Background="{StaticResource SolidBackgroundFillColorBaseAltBrush}"
                Visibility="{Binding IsDataLoading, Converter={StaticResource BoolToVisibilityConverter}, Mode=OneWay}">
            <StackPanel Orientation="Vertical"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center">
                <ProgressRing IsIndeterminate="True"
                              IsActive="{x:Bind Vm.IsDataLoading, Mode=TwoWay}"
                              Margin="20"
                              HorizontalContentAlignment="Stretch"
                              VerticalContentAlignment="Stretch">
                    <!--<ProgressRing.Background>
                        <SolidColorBrush Color="Black"
                                         Opacity="0.7" />
                    </ProgressRing.Background>-->
                </ProgressRing>
                <TextBlock x:Uid="Loading" />
            </StackPanel>
        </Border>
    </Grid>
</Window>
